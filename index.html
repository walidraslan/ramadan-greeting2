<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ØªÙ‡Ù†Ø¦Ø© Ø±Ù…Ø¶Ø§Ù†</title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;800&display=swap" rel="stylesheet">

  <style>
    body{
      margin:0;
      font-family:"Cairo", system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:#0b2b3a; color:#fff;
      display:flex; min-height:100vh; align-items:center; justify-content:center; padding:16px;
    }
    .wrap{
      width:min(620px, 100%);
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.15);
      border-radius:16px; padding:16px;
      backdrop-filter: blur(6px);
    }
    h1{ font-size:18px; margin:0 0 12px; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    input[type="text"], input[type="file"]{
      flex:1; min-width:220px;
      padding:12px 14px; border-radius:12px;
      border:1px solid rgba(255,255,255,.2);
      outline:none; font-size:15px;
      background:rgba(255,255,255,.10);
      color:#fff;
    }
    input[type="file"]{ padding:10px 12px; }
    button{
      padding:12px 14px; border-radius:12px; border:0; cursor:pointer; font-weight:800;
      white-space:nowrap;
    }
    .btn1{ background:#ffffff; color:#0b2b3a; }
    .btn2{ background:#2dd4bf; color:#062a2a; }
    .btn3{ background:#ef4444; color:#fff; }

    canvas{
      width:100%; height:auto; margin-top:14px; border-radius:14px;
      background:#000; display:block;
    }
    .hint{ opacity:.85; font-size:13px; margin-top:10px; line-height:1.7; }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>ğŸŒ™ ØªÙ‡Ù†Ø¦Ø© Ø±Ù…Ø¶Ø§Ù† â€” Ø§Ø±ÙØ¹ ØµÙˆØ±ØªÙƒ + Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ ÙˆØ­Ù…Ù‘Ù„ Ø§Ù„ØµÙˆØ±Ø© PNG</h1>

    <div class="row">
      <input id="nameInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§..." />
      <input type="file" id="photoInput" accept="image/*" />
      <button class="btn1" id="makeBtn">ØªØ­Ø¯ÙŠØ«</button>
      <button class="btn3" id="clearPhotoBtn">Ù…Ø³Ø­ Ø§Ù„ØµÙˆØ±Ø©</button>
      <button class="btn2" id="dlBtn">ØªØ­Ù…ÙŠÙ„ PNG</button>
    </div>

    <canvas id="cv"></canvas>

    <div class="hint">
      âœ… Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø«Ù… Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…. <br/>
      ğŸ’¡ Ù…Ù…ÙƒÙ† ØªØ¨Ø¹Øª Ù„ÙŠÙ†Ùƒ Ø¨Ø§Ø³Ù… Ø¬Ø§Ù‡Ø²: <b>?name=Ahmed</b>
    </div>
  </div>

<script>
  const canvas = document.getElementById("cv");
  const ctx = canvas.getContext("2d");

  const img = new Image();
  img.src = "ramadan.png"; // ØµÙˆØ±Ø© Ø§Ù„ØªÙ‡Ù†Ø¦Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©

  const nameInput = document.getElementById("nameInput");
  const photoInput = document.getElementById("photoInput");
  const makeBtn = document.getElementById("makeBtn");
  const dlBtn = document.getElementById("dlBtn");
  const clearPhotoBtn = document.getElementById("clearPhotoBtn");

  let userPhoto = null;

  function getNameFromURL(){
    const p = new URLSearchParams(location.search);
    return p.get("name") || "";
  }

  // Ø±Ø³Ù… ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ø®Ù„ Ø¯Ø§Ø¦Ø±Ø© (Ù‚Øµ Ø¯Ø§Ø¦Ø±ÙŠ + cover)
  function drawUserPhotoCircle() {
    if (!userPhoto) return;

    // âœ… Ø¯ÙŠ Ù‚ÙŠÙ… Ù…Ù†Ø§Ø³Ø¨Ø© Ù„ØµÙˆØ±ØªÙƒ (572 Ã— 1024)
    const cx = 286;   // Ù…Ø±ÙƒØ² Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© X
    const cy = 300;   // Ù…Ø±ÙƒØ² Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Y
    const r  = 130;   // Ù†ØµÙ Ø§Ù„Ù‚Ø·Ø±

    ctx.save();
    ctx.beginPath();
    ctx.arc(cx, cy, r, 0, Math.PI * 2);
    ctx.closePath();
    ctx.clip();

    const iw = userPhoto.naturalWidth;
    const ih = userPhoto.naturalHeight;

const target = 2 * r;

// 1) ØªØµØºÙŠØ± Ø§Ù„ØµÙˆØ±Ø© (Zoom out)
// zoom < 1  => Ø§Ù„ØµÙˆØ±Ø© ØªØ¨Ø§Ù† Ø£ØµØºØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©
// zoom = 1  => Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ
const zoom = 0.85;   // Ø¬Ø±Ù‘Ø¨ 0.80 Ø£Ùˆ 0.75 Ù„Ùˆ Ù„Ø³Ù‡ ÙƒØ¨ÙŠØ±Ø©

// 2) ØªØ­Ø±ÙŠÙƒ Ø§Ù„ØµÙˆØ±Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©
// panY Ù…ÙˆØ¬Ø¨ => Ø§Ù„ØµÙˆØ±Ø© ØªÙ†Ø²Ù„ Ù„ØªØ­Øª
// panX Ù…ÙˆØ¬Ø¨ => Ø§Ù„ØµÙˆØ±Ø© ØªØ±ÙˆØ­ ÙŠÙ…ÙŠÙ†
const panX = 0;       // Ø¬Ø±Ù‘Ø¨ 10 Ø£Ùˆ -10 Ù„Ùˆ Ø§Ø­ØªØ¬Øª
const panY = 35;      // Ø¬Ø±Ù‘Ø¨ 50 Ù„Ùˆ Ø¹Ø§ÙŠØ²Ù‡Ø§ ØªÙ†Ø²Ù„ Ø£ÙƒØªØ±

// Ø¨Ø¯Ù„ cover (Math.max) Ù‡Ù†Ø³ØªØ®Ø¯Ù… contain (Math.min) Ø¹Ø´Ø§Ù† ØªØ¨Ø§Ù† Ø£ØµØºØ± ÙˆØªÙØ¶Ù„ Ø¬ÙˆÙ‡ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©
const scale = Math.min(target / iw, target / ih) * zoom;

// Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø±Ø³Ù… Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ (Ø¨Ø¹Ø¯ Ø§Ù„ØªØµØºÙŠØ±)
const dw = iw * scale;
const dh = ih * scale;

// Ù†Ø®Ù„ÙŠ Ø§Ù„ØµÙˆØ±Ø© ØªØªÙˆØ³Ù‘Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ø¥Ø²Ø§Ø­Ø©
const dx = (cx - dw / 2) + panX;
const dy = (cy - dh / 2) + panY;

// Ø§Ø±Ø³Ù… Ø§Ù„ØµÙˆØ±Ø© (Ø¨Ø¯ÙˆÙ† Ù‚Øµ Ø¥Ø¶Ø§ÙÙŠ Ù„Ø£Ù†Ù†Ø§ Ø£ØµÙ„Ø§Ù‹ Ø¹Ø§Ù…Ù„ÙŠÙ† clip Ù„Ù„Ø¯Ø§Ø¦Ø±Ø© ÙÙˆÙ‚)
ctx.drawImage(userPhoto, dx, dy, dw, dh);
    ctx.restore();

    // Ø¥Ø·Ø§Ø± Ø¨Ø³ÙŠØ· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
    ctx.save();
    ctx.lineWidth = 6;
    ctx.strokeStyle = "rgba(200,160,80,0.9)";
    ctx.beginPath();
    ctx.arc(cx, cy, r, 0, Math.PI * 2);
    ctx.stroke();
    ctx.restore();
  }

  function drawName(name){
    // âœ… Ù…ÙƒØ§Ù† Ø§Ù„Ø§Ø³Ù… Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„ Ø§Ù„Ø£Ø¨ÙŠØ¶ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙˆØ±Ø©
    const x = 286; // Ù…Ù†ØªØµÙ Ø§Ù„Ø¹Ø±Ø¶
    const y = 865; // Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„

    let fontSize = 48;
    ctx.textAlign = "center";
    ctx.direction = "rtl";
    ctx.textBaseline = "middle";
    ctx.fillStyle = "#000000";

    const maxWidth = 430; // Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ¨ÙŠ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„
    ctx.font = `800 ${fontSize}px Cairo`;

    while(ctx.measureText(name).width > maxWidth && fontSize > 24){
      fontSize--;
      ctx.font = `800 ${fontSize}px Cairo`;
    }

    ctx.shadowColor = "rgba(0,0,0,0.10)";
    ctx.shadowBlur = 2;
    ctx.shadowOffsetY = 1;

    ctx.fillText(name || "Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ", x, y);
  }

  function drawCard(){
    if(!img.complete) return;

    // Ù†ÙØ³ Ø£Ø¨Ø¹Ø§Ø¯ ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©
    canvas.width  = img.naturalWidth;
    canvas.height = img.naturalHeight;

    // Ø§Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ©
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(img,0,0);

    // Ø§Ø±Ø³Ù… ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯Ø©)
    drawUserPhotoCircle();

    // Ø§Ø±Ø³Ù… Ø§Ù„Ø§Ø³Ù…
    drawName(nameInput.value.trim());
  }

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø«Ù… Ø±Ø³Ù…
  img.onload = async () => {
    try { await document.fonts.ready; } catch(e){}
    const preName = getNameFromURL();
    if(preName) nameInput.value = preName;
    drawCard();
  };

  // Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  photoInput.addEventListener("change", () => {
    const file = photoInput.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
      const im = new Image();
      im.onload = () => {
        userPhoto = im;
        drawCard();
      };
      im.src = reader.result;
    };
    reader.readAsDataURL(file);
  });

  // ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù…
  nameInput.addEventListener("input", drawCard);
  makeBtn.onclick = drawCard;

  // Ù…Ø³Ø­ Ø§Ù„ØµÙˆØ±Ø©
  clearPhotoBtn.onclick = () => {
    userPhoto = null;
    photoInput.value = "";
    drawCard();
  };

  // ØªØ­Ù…ÙŠÙ„ PNG
  dlBtn.onclick = () => {
    const a = document.createElement("a");
    a.download = "ramadan-greeting.png";
    a.href = canvas.toDataURL("image/png");
    a.click();
  };
</script>
</body>
</html>



