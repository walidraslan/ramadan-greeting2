<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ØªÙ‡Ù†Ø¦Ø© Ø±Ù…Ø¶Ø§Ù†</title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;800&display=swap" rel="stylesheet">

  <style>
    body{
      margin:0;
      font-family:"Cairo", system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:#0b2b3a; color:#fff;
      display:flex; min-height:100vh; align-items:center; justify-content:center; padding:16px;
    }
    .wrap{
      width:min(560px, 100%);
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.15);
      border-radius:16px; padding:16px;
      backdrop-filter: blur(6px);
    }
    h1{ font-size:18px; margin:0 0 12px; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    input[type="text"]{
      flex:1; min-width:200px;
      padding:12px 14px; border-radius:12px;
      border:1px solid rgba(255,255,255,.2);
      outline:none; font-size:16px;
    }
    button{
      padding:12px 14px; border-radius:12px; border:0; cursor:pointer; font-weight:800;
    }
    .btn1{ background:#ffffff; color:#0b2b3a; }
    .btn2{ background:#2dd4bf; color:#062a2a; }
    canvas{
      width:100%; height:auto; margin-top:14px; border-radius:14px;
      background:#000; display:block;
    }
    .hint{ opacity:.85; font-size:13px; margin-top:10px; line-height:1.6; }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>ðŸŒ™ ØªÙ‡Ù†Ø¦Ø© Ø±Ù…Ø¶Ø§Ù† â€” Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ ÙˆØ­Ù…Ù‘Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¬Ø§Ù‡Ø²Ø©</h1>

    <div class="row">
      <input id="nameInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§..." />
      <button class="btn1" id="makeBtn">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù…</button>
      <button class="btn2" id="dlBtn">ØªØ­Ù…ÙŠÙ„ PNG</button>
    </div>

    <canvas id="cv"></canvas>

    <div class="hint">
      ðŸ’¡ ØªÙ‚Ø¯Ø± ØªØ¨Ø¹Øª Ù„ÙŠÙ†Ùƒ Ø¨Ø§Ø³Ù… Ø¬Ø§Ù‡Ø²: <b>?name=Ahmed</b>
    </div>
  </div>

<script>
  const canvas = document.getElementById("cv");
  const ctx = canvas.getContext("2d");

  const img = new Image();
  img.src = "ramadan.png"; // Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù… ÙˆÙ…ÙˆØ¬ÙˆØ¯Ø© Ø¬Ù†Ø¨ index.html

  const nameInput = document.getElementById("nameInput");
  const makeBtn = document.getElementById("makeBtn");
  const dlBtn = document.getElementById("dlBtn");

  function getNameFromURL(){
    const p = new URLSearchParams(location.search);
    return p.get("name") || "";
  }

  function drawCard(name){
    if(!img.complete) return;

    // Ø®Ù„ÙŠ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ Ù†ÙØ³ Ù…Ù‚Ø§Ø³ ØµÙˆØ±Ø© Ø§Ù„ØªØµÙ…ÙŠÙ…
    canvas.width  = img.naturalWidth;
    canvas.height = img.naturalHeight;

    // Ø§Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ©
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(img,0,0);

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Øµ
    let fontSize = Math.round(canvas.width * 0.07);
    ctx.textAlign = "center";
    ctx.direction = "rtl";
    ctx.fillStyle = "#000000";
    ctx.textBaseline = "middle";

    // Ù…ÙƒØ§Ù† Ø§Ù„Ø§Ø³Ù… (Ø¹Ø¯Ù‘Ù„Ù‡Ù… Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø­Ø³Ø¨ ØªØµÙ…ÙŠÙ…Ùƒ)
    const x = canvas.width  * 0.50;
    const y = canvas.height * 0.90;

    // ØµØºÙ‘Ø± Ø§Ù„Ø®Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ùˆ Ø§Ù„Ø§Ø³Ù… Ø·ÙˆÙŠÙ„
    const maxWidth = canvas.width * 0.78;
    ctx.font = `800 ${fontSize}px Cairo`;
    while(ctx.measureText(name).width > maxWidth && fontSize > 22){
      fontSize--;
      ctx.font = `800 ${fontSize}px Cairo`;
    }

    // Ø¸Ù„ Ø¨Ø³ÙŠØ·
    ctx.shadowColor = "rgba(0,0,0,0.12)";
    ctx.shadowBlur = 2;
    ctx.shadowOffsetY = 1;

    // Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…
    ctx.fillText(name || "Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ", x, y);
  }

  img.onload = async () => {
    try { await document.fonts.ready; } catch(e){}
    const preName = getNameFromURL();
    if(preName) nameInput.value = preName;
    drawCard(nameInput.value.trim());
  };

  nameInput.addEventListener("input", () => drawCard(nameInput.value.trim()));
  makeBtn.onclick = () => drawCard(nameInput.value.trim());

  dlBtn.onclick = () => {
    // ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
    const a = document.createElement("a");
    a.download = "ramadan-greeting.png";
    a.href = canvas.toDataURL("image/png");
    a.click();
  };
</script>
</body>
</html>
